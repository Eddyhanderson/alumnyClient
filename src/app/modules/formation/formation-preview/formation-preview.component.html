<div class="main">
    <ng-container *ngIf="formation; else loadingPage">
        <div class="wallpaper-container wallpaper-container-lg mb-4">
            <div class="background-container">
                <img [src]="buildImageUrl(formation.picture)">
                <div class="shadow-ff" style="top: 0;"></div>
            </div>
            <div class="wallpaper-actions d-flex flex-column align-items-center justify-content-center w-100">
                <h1 class="bold-500 mb-4">
                    {{formation.theme}}
                </h1>
                <div class="d-flex flex-column align-items-start mb-4">
                    <div class="d-flex align-items-center justify-content-start">
                        <span class="star-fill">
                            <h4 class="mr-1 mb-1">
                                3,4
                            </h4>
                        </span>
                        <div class="d-flex">
                            <mat-icon class="star-fill">
                                star
                            </mat-icon>
                            <mat-icon class="star-fill">
                                star
                            </mat-icon>
                            <mat-icon class="star-fill">
                                star
                            </mat-icon>
                            <mat-icon class="star-unfill-white">
                                star
                            </mat-icon>
                            <mat-icon class="star-unfill-white">
                                star
                            </mat-icon>
                        </div>
                    </div>
                    <div class="d-flex justify-content-start mb-2">
                        <div class="d-flex flex-column color-white">
                            <span class="mb-2 d-flex align-items-center">
                                <mat-icon class="mr-4">
                                    topic
                                </mat-icon>
                                <span>{{formation.modulesCount }} Módulos</span>
                            </span>
                            <span class="mb-2 d-flex align-items-center">
                                <mat-icon class="mr-4">
                                    play_lesson
                                </mat-icon>
                                <span>{{formation.lessonCount}} Aulas </span>
                            </span>
                            <span class="mb-2 d-flex align-items-center">
                                <mat-icon class="mr-4">
                                    school
                                </mat-icon>
                                <span>{{formation.subscriptionCount}} Inscritos </span>
                            </span>
                            <span class="mb-2 d-flex align-items-center">
                                <mat-icon class="mr-4">
                                    people
                                </mat-icon>
                                <span>{{formation.studantLimit}} Lugares </span>
                            </span>
                        </div>
                    </div>

                    <div class="d-flex align-items-center mb-2">
                        <div class="img-profile-xm mr-2">
                            <img [src]="buildImageUrl(formation.schoolPicture)">
                        </div>
                        <div class="d-flex flex-column">
                            <a>
                                {{formation.schoolName}}
                            </a>
                            <span class="irrelevant-text color-white-dark">
                                Começa em {{formation.start | date:'yyyy/MM/dd'}}
                            </span>
                        </div>
                    </div>
                </div>
                <div class="d-flex align-items-center justify-content-center">
                    <ng-container *ngIf="formationRequest; else noSubscribed">
                        <ng-container>
                            <mat-chip-list *ngIf="formationRequest.state == 'WatingResponsableAction'">
                                <mat-chip [selectable]="false" removable="false">
                                    Aguardando Parecer do Responsável
                                </mat-chip>
                            </mat-chip-list>

                            <mat-chip-list *ngIf="formationRequest.state == 'WaitingManagerAction'">
                                <mat-chip [selectable]="false" removable="false">
                                    Aguardando Parecer da Academia
                                </mat-chip>
                            </mat-chip-list>
                        </ng-container>
                    </ng-container>

                    <ng-template #noSubscribed>
                        <button  mat-flat-button color="primary" class="button-lg"
                            (click)="onRequestFormation()">
                            <div class="d-flex align-items-center">
                                <span>INSCREVER-SE</span>
                                <div class="circle-diviser"></div>
                                {{formation.price | currency:'AKZ'}}
                            </div>
                        </button>
                    </ng-template>

                </div>
            </div>
        </div>
        <div class="section-row">
            <div class="container-column mb-4">
                <ng-container>
                    <div class="item border rounded d-flex flex-column">
                        <mat-card-title class="p-3 mb-2">
                            {{lesson.title}}
                        </mat-card-title>

                        <div class="p-3">
                            <p>
                                {{lesson.description}}
                            </p>
                        </div>
                    </div>
                </ng-container>

                <div class="border rounded item p-3 mt-4">
                    <mat-card-title class="mb-3">
                        Avaliações
                    </mat-card-title>
                    <mat-card-content>
                        <div class="d-flex flex-column mt-3">
                            <div class="d-flex flex-column">
                                <div class="d-flex align-items-center">
                                    <div class="img-profile-xm">
                                        <img src="../../../../../assets/images/pexels-luis-gomes-546819.jpg">
                                    </div>
                                    <div class="d-flex flex-column ml-2">
                                        <span class="bold-500">
                                            <h3>
                                                Manuel Felipe
                                            </h3>
                                        </span>
                                        <span class="irrelevant-text text-disabled-1">
                                            há 1 semana
                                        </span>
                                    </div>
                                </div>
                                <div class="d-flex my-2">
                                    <mat-icon class="star-fill">
                                        star
                                    </mat-icon>
                                    <mat-icon class="star-fill">
                                        star
                                    </mat-icon>
                                    <mat-icon class="star-fill">
                                        star
                                    </mat-icon>
                                    <mat-icon class="star-unfill">
                                        star
                                    </mat-icon>
                                    <mat-icon class="star-unfill">
                                        star
                                    </mat-icon>
                                </div>
                                <span>
                                    Eu gostei da formação, o professor responde muito rápido às questões e com uma
                                    exatidão
                                    incrivel.
                                </span>
                            </div>
                        </div>
                    </mat-card-content>
                </div>
            </div>
            <div class="container-column place-items-start">
                <ng-container *ngIf="modules$; else loadingItems">
                    <ng-container *ngIf="modules$ | async as modules; else loadingItems">
                        <div class="item border rounded p-3">
                            <mat-card-title class="mb-3">
                                Módulos
                            </mat-card-title>
                            <mat-card-content class="mt-3">
                                <mat-accordion>
                                    <mat-expansion-panel *ngFor="let module of modules">
                                        <mat-expansion-panel-header>
                                            <mat-panel-title>
                                                Módulo {{module.sequence}} - {{module.name}}
                                            </mat-panel-title>
                                        </mat-expansion-panel-header>
                                        <mat-selection-list [multiple]="false" [formControl]="moduleControl"
                                            (selectionChange)="onModuleListChange($event)" [compareWith]="compare">
                                            <mat-list-option *ngFor="let lesson of module.lessons" [value]="lesson">
                                                <mat-icon matListIcon>
                                                    {{lesson.lessonType.toUpperCase() == 'VIDEO' ? 'video_library' :
                                                    'article'}}
                                                </mat-icon>
                                                <h4 matLine>Aula {{lesson.sequence}} - {{lesson.title}}</h4>
                                                <p matLine>
                                                    {{lesson.lessonType.toUpperCase() == 'VIDEO' ? 'Video' : 'Artigo'}}
                                                </p>
                                            </mat-list-option>
                                        </mat-selection-list>
                                    </mat-expansion-panel>
                                </mat-accordion>
                            </mat-card-content>
                        </div>
                    </ng-container>
                </ng-container>
            </div>
        </div>
    </ng-container>
</div>
<ng-template #loadingItems>
    <app-loading-item class="w-100"></app-loading-item>
</ng-template>

<ng-template #loadingPage>
    <app-loading-page class="w-100"></app-loading-page>
</ng-template>

<ng-template #noHaveTopics>
    <div class="d-flex w-100 justify-content-center align-items-center">
        <span>
            Não há tópicos de momento
        </span>
    </div>
</ng-template>

<ng-template #noHaveLessons>
    <div class="d-flex w-100 justify-content-center align-items-center">
        <span>
            Não há aulas de momento
        </span>
    </div>
</ng-template>